<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Universal Dashboard mit Settings-Sidebar (Fix)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/gridstack@9.2.2/dist/gridstack.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/gridstack@9.2.2/dist/gridstack-all.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    body { margin: 0; transition: background 0.2s;}
    .grid-stack-item-content {
      background: #005983;
      border-radius: 1.75rem;
      color: white;
      padding: 1.5rem 1rem 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      min-height: 350px;
    }
    #sidebar { min-width: 220px; max-width: 340px; transition: all 0.2s; }
    #template-list .dragging { opacity: 0.4; }
    .attachment-list { font-size: 0.92em; color: #2563eb; margin-top: 2px; }
    .config-sidebar {
      position: fixed;
      top: 0; right: 0; z-index: 50;
      width: 420px; max-width: 100vw;
      height: 100vh; background: #fff;
      box-shadow: -4px 0 18px #0004;
      transform: translateX(110%);
      transition: transform 0.25s;
      display: flex; flex-direction: column;
      padding: 32px 30px 18px 30px;
      gap: 1rem;
    }
    .config-sidebar.open { transform: translateX(0); }
    .config-backdrop {
      display: none;
      position:fixed; left:0; top:0; width:100vw; height:100vh; z-index:49;
      background:rgba(0,0,0,0.18);
    }
    .config-backdrop.open { display:block; }
    .config-sidebar:not(.open), .config-backdrop:not(.open) { pointer-events:none; }
    @media (max-width: 600px) {
      .config-sidebar { width: 100vw; min-width:0; padding:20px 5vw; }
    }
  </style>
</head>
<body class="bg-gray-100">
<div class="flex">
  <!-- Sidebar -->
  <aside id="sidebar" class="w-72 min-h-screen bg-gray-50 p-4 border-r flex flex-col gap-4">
    <button id="pick-module-folder" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded mb-2">Modul-Root-Ordner ausw√§hlen</button>
    <h2 class="font-bold text-lg mb-2">Module (Live)</h2>
    <div id="template-list" class="flex flex-col gap-2"></div>
  </aside>
  <main class="flex-1 h-screen relative">
    <header class="flex items-center bg-white p-6 shadow">
      <button id="toggle-sidebar" class="mr-4 bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded" title="Sidebar ein-/ausblenden">
        <span id="sidebar-icon">üëÅÔ∏è</span>
      </button>
      <h1 class="text-2xl font-bold">üóÇÔ∏è Universal Dashboard mit Einstellungen</h1>
      <div id="current-path" class="path-display ml-6">Ausgew√§hlter Ordner: <em>nicht gesetzt</em></div>
      <button id="toggle-config" class="ml-6 bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded" title="Einstellungen"><span>‚öôÔ∏è</span></button>
      <div class="ml-auto flex gap-2">
        <button id="set-main-folder" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Hauptordner w√§hlen</button>
        <button id="load-config" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">Konfiguration laden</button>
        <button id="save-config" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Konfiguration speichern</button>
      </div>
    </header>
    <input type="file" id="folder-input" webkitdirectory directory multiple hidden />
    <input type="file" id="config-input" accept="application/json" hidden />
    <div id="canvas-dropzone" class="h-full w-full">
      <div class="grid-stack p-6" style="min-height:650px"></div>
    </div>
  </main>
  
</div>

<!-- CONFIG SIDEBAR -->
<div id="config-backdrop" class="config-backdrop"></div>
<aside id="config-sidebar" class="config-sidebar">
  <h2 class="font-bold text-xl mb-2">‚öôÔ∏è Einstellungen</h2>
  <label class="font-semibold mt-2 mb-0">Modul-Root-Ordner:
    <div class="flex items-center gap-2">
      <input id="set-modules-path" type="text" readonly class="border p-1 w-full bg-gray-100" />
      <button id="set-modules-path-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded">Ausw√§hlen</button>
    </div>
  </label>
  <label class="font-semibold mt-2 mb-0">Config-Speicherort (optional):
    <input id="set-config-path" type="text" class="border p-1 w-full" placeholder="Pfad oder Dateiname" />
  </label>
  <label class="font-semibold mt-2 mb-0">Scaling / Zoom:
    <input id="set-scaling" type="range" min="0.5" max="2" step="0.05" value="1" />
    <span id="scaling-value">1.0</span>
  </label>
  <label class="font-semibold mt-2 mb-0">Theme:
    <select id="set-theme" class="border p-1 w-full">
      <option value="auto">System</option>
      <option value="light">Hell</option>
      <option value="dark">Dunkel</option>
    </select>
  </label>
  <label class="font-semibold mt-2 mb-0">Sprache:
    <select id="set-lang" class="border p-1 w-full">
      <option value="de">Deutsch</option>
      <option value="en">English</option>
    </select>
  </label>
  <div class="flex gap-2 mt-6">
    <button id="save-configs" class="bg-green-600 text-white px-4 py-2 rounded">Speichern</button>
    <button id="close-configs" class="bg-gray-500 text-white px-4 py-2 rounded">Schlie√üen</button>
    <button id="reset-configs" class="bg-red-400 text-white px-4 py-2 rounded">Reset</button>
  </div>
</aside>

<script>
  // === CONFIG SIDEBAR ===
  const configSidebar = document.getElementById('config-sidebar');
  const configBackdrop = document.getElementById('config-backdrop');
  function showConfigSidebar(show=true) {
    configSidebar.classList.toggle('open', show);
    configBackdrop.classList.toggle('open', show);
    if (show) fillConfigUI();
  }
  document.getElementById('toggle-config').onclick = () => showConfigSidebar(true);
  document.getElementById('close-configs').onclick = () => showConfigSidebar(false);
  configBackdrop.onclick = () => showConfigSidebar(false);

  // SETTINGS STATE
  let settings = {
    modulesPath: "",
    configPath: "",
    scaling: 1,
    theme: "auto",
    lang: "de"
  };

  function fillConfigUI() {
    document.getElementById('set-modules-path').value = settings.modulesPath || "";
    document.getElementById('set-config-path').value = settings.configPath || "";
    document.getElementById('set-scaling').value = settings.scaling || 1;
    document.getElementById('scaling-value').innerText = Number(settings.scaling).toFixed(2);
    document.getElementById('set-theme').value = settings.theme || "auto";
    document.getElementById('set-lang').value = settings.lang || "de";
  }

  document.getElementById('set-modules-path-btn').onclick = async function() {
    try {
      const handle = await window.showDirectoryPicker();
      settings.modulesPath = handle.name;
      localStorage.setItem('modulesPath', handle.name);
      document.getElementById('set-modules-path').value = handle.name;
    } catch {}
  };

  document.getElementById('set-scaling').oninput = function(e) {
    const v = e.target.value;
    document.getElementById('scaling-value').innerText = Number(v).toFixed(2);
    document.body.style.zoom = v;
    settings.scaling = v;
  };

  document.getElementById('set-theme').onchange = function(e) {
    const t = e.target.value;
    settings.theme = t;
    if (t === 'dark') document.body.classList.add('bg-gray-900');
    else document.body.classList.remove('bg-gray-900');
  };

  document.getElementById('set-lang').onchange = function(e) {
    settings.lang = e.target.value;
  };

  document.getElementById('save-configs').onclick = () => {
    settings.configPath = document.getElementById('set-config-path').value;
    settings.scaling = document.getElementById('set-scaling').value;
    settings.theme = document.getElementById('set-theme').value;
    settings.lang = document.getElementById('set-lang').value;
    for (let k in settings) localStorage.setItem(k, settings[k]);
    showConfigSidebar(false);
    alert('Einstellungen gespeichert!');
  };

  document.getElementById('reset-configs').onclick = () => {
    localStorage.clear();
    settings = {modulesPath:"",configPath:"",scaling:1,theme:"auto",lang:"de"};
    fillConfigUI();
    alert('Einstellungen zur√ºckgesetzt!');
  };

  function loadSettings() {
    for (let k in settings) {
      let v = localStorage.getItem(k);
      if (v !== null) settings[k] = v;
    }
    fillConfigUI();
    if (settings.scaling) document.body.style.zoom = settings.scaling;
    if (settings.theme==="dark") document.body.classList.add('bg-gray-900');
  }
  loadSettings();

  // == FIX: Sidebar & Backdrop blockieren keine Klicks mehr wenn hidden ==
  const observer = new MutationObserver(() => {
    configSidebar.style.pointerEvents = configSidebar.classList.contains('open') ? "" : "none";
    configBackdrop.style.pointerEvents = configBackdrop.classList.contains('open') ? "" : "none";
  });
  observer.observe(configSidebar, { attributes: true, attributeFilter: ['class'] });
  observer.observe(configBackdrop, { attributes: true, attributeFilter: ['class'] });

  // === Universal Dashboard Features ===
  let moduleDirHandle = null;
  let sidebarRefreshInterval = null;
  let liveModuleTemplates = [];
  let grid;
  let moduleCounter = 0;
  let mainFolderHandle = { isFallback: true, name: '', files: [] };
  const pathEl = document.getElementById('current-path');

  // --------- Module Sidebar & Drag&Drop ---------
  document.getElementById('pick-module-folder').onclick = async function() {
    try {
      moduleDirHandle = await window.showDirectoryPicker();
      await refreshSidebarModules();
      if (sidebarRefreshInterval) clearInterval(sidebarRefreshInterval);
      sidebarRefreshInterval = setInterval(refreshSidebarModules, 2000);
    } catch (e) {
      alert('Ordnerauswahl abgebrochen oder nicht erlaubt.');
    }
  };
  async function refreshSidebarModules() {
    if (!moduleDirHandle) return;
    const templates = [];
    for await (const entry of moduleDirHandle.values()) {
      if (entry.kind === 'directory') {
        let moduleJson = null, attachments = [], dirHandle = entry;
        for await (const fileEntry of entry.values()) {
          if (fileEntry.kind === 'file' && fileEntry.name.endsWith('.json')) {
            const file = await fileEntry.getFile();
            moduleJson = JSON.parse(await file.text());
          } else if (fileEntry.kind === 'file') {
            attachments.push(fileEntry.name);
          }
        }
        if (moduleJson) {
          templates.push({
            template: moduleJson,
            subdir: entry.name,
            attachments: attachments,
            dirHandle: dirHandle
          });
        }
      }
    }
    liveModuleTemplates = templates;
    renderSidebar(templates);
  }
  function renderSidebar(templates) {
    const templateList = document.getElementById('template-list');
    templateList.innerHTML = '';
    if (templates.length === 0) {
      templateList.innerHTML = '<div class="text-gray-400">Keine Modulordner gefunden.</div>';
    }
    templates.forEach((modObj, idx) => {
      const {template, subdir, attachments} = modObj;
      const card = document.createElement('div');
      card.className = 'bg-white border rounded p-3 cursor-grab shadow hover:bg-blue-50 transition flex flex-col';
      card.draggable = true;
      card.innerHTML = `<div class="flex items-center gap-2">
        ${(template.icon ? `<span class="text-xl">${template.icon}</span>` : '')}
        <span class="font-semibold">${template.name || subdir}</span>
        <span class="ml-2 text-xs text-gray-400">${subdir}</span>
      </div>
      ${attachments && attachments.length ?
         `<div class="attachment-list">üìé ${attachments.join(', ')}</div>` : ''}`;
      card.addEventListener('dragstart', e => {
        e.dataTransfer.setData('module-template', idx.toString());
        card.classList.add('dragging');
      });
      card.addEventListener('dragend', e => card.classList.remove('dragging'));
      templateList.appendChild(card);
    });
  }
  const dropzone = document.getElementById('canvas-dropzone');
  dropzone.addEventListener('dragover', e => e.preventDefault());
  dropzone.addEventListener('drop', async e => {
    e.preventDefault();
    const idx = e.dataTransfer.getData('module-template');
    const modObj = liveModuleTemplates[idx];
    if (modObj) {
      const tmpl = modObj.template;
      const gridPos = grid.getCellFromPixel({ left: e.clientX - dropzone.getBoundingClientRect().left, top: e.clientY - dropzone.getBoundingClientRect().top });
      if (tmpl.script) {
        // Lade und f√ºhre das Modul-JS aus
        const jsFileName = modObj.attachments.find(fn => fn.endsWith('.js') && fn.replace('.js','') === tmpl.script.replace('render',''));
        if (!jsFileName) return alert('Kein Modul-JS gefunden!');
        await loadAndRunModuleScript(jsFileName, tmpl, modObj, gridPos);
      } else if (tmpl.fields) {
        createUniversalModule(tmpl, gridPos, modObj.dirHandle, modObj.attachments, modObj.subdir);
      } else {
        createModule(tmpl.name, tmpl.subs || [], tmpl.comments || [], gridPos);
      }
    }
  });
  async function loadAndRunModuleScript(jsFile, moduleJson, modObj, gridPos) {
    const jsHandle = await modObj.dirHandle.getFileHandle(jsFile);
    const jsFileObj = await jsHandle.getFile();
    const jsText = await jsFileObj.text();
    eval(jsText); // legt window[renderFunc] an
    const el = document.createElement('div');
    el.classList.add('grid-stack-item');
    el.innerHTML = `<div class="grid-stack-item-content" id="custommod-content"></div>`;
    grid.addWidget(el, gridPos);
    if (typeof window[moduleJson.script] === "function") {
      window[moduleJson.script](el.querySelector('#custommod-content'), {
        moduleJson, dirHandle: modObj.dirHandle, attachments: modObj.attachments, subdir: modObj.subdir
      });
    }
  }

  // --------- Hauptordner und Path-Display ---------
  function updatePath(name) {
    pathEl.textContent = 'Ausgew√§hlter Ordner: ' + (name || 'nicht gesetzt');
  }
  async function setMainFolder() {
    if (window.showDirectoryPicker) {
      try {
        mainFolderHandle = await window.showDirectoryPicker();
        updatePath(mainFolderHandle.name);
      } catch (_) {}
    } else {
      const inp = document.getElementById('folder-input');
      inp.onchange = e => {
        const files = Array.from(e.target.files);
        if (files.length) {
          const root = files[0].webkitRelativePath.split('/')[0];
          mainFolderHandle = { isFallback: true, name: root, files };
          updatePath(root);
        }
        inp.value = null;
      };
      inp.click();
    }
  }

  // --------- Standard/Universal-Modul-Renderer ---------
  function createModule(title, subNames = [], subComments = [], pos) {
    const id = moduleCounter++;
    const el = document.createElement('div');
    el.classList.add('grid-stack-item');
    el.innerHTML = `
      <div class="grid-stack-item-content">
        <div class="drag-handle">
          <span class="module-title">${title}</span>
          <div class="flex items-center gap-2">
            <button class="remove-module bg-red-500 hover:bg-red-600 text-white px-2 rounded">üóëÔ∏è</button>
            <button id="addSub-${id}" class="bg-green-500 hover:bg-green-600 text-white px-2 rounded">+ Hinzuf√ºgen</button>
          </div>
        </div>
        <div class="submodule-container" id="cont-${id}"></div>
      </div>`;
    grid.addWidget(el, pos || { x:0, y:0, w:6, h:2 });
    const container = el.querySelector(`#cont-${id}`);
    subNames.forEach((name, i) => {
      const div = document.createElement('div');
      div.className = 'submodule';
      div.innerHTML = `
        <span class="label">${name}</span>
        <button class="rename">‚úèÔ∏è</button>
        <button class="remove">üóëÔ∏è</button>
        <textarea class="comments">${subComments[i] || ''}</textarea>
      `;
      container.appendChild(div);
    });
    Sortable.create(container, { group:'shared', animation:150 });
    el.querySelector('.remove-module').onclick = () => grid.removeWidget(el);
    el.querySelector(`#addSub-${id}`).onclick = () => {
      const div = document.createElement('div');
      div.className = 'submodule';
      div.innerHTML = `
        <span class="label">Neu</span>
        <button class="rename">‚úèÔ∏è</button>
        <button class="remove">üóëÔ∏è</button>
        <textarea class="comments" placeholder="Kommentar"></textarea>
      `;
      container.appendChild(div);
    };
    container.addEventListener('click', e => {
      const sub = e.target.closest('.submodule');
      if (!sub) return;
      if (e.target.classList.contains('remove')) sub.remove();
      if (e.target.classList.contains('rename')) {
        const old = sub.querySelector('.label').textContent;
        const neu = prompt('Neuer Name:', old);
        if (neu) sub.querySelector('.label').textContent = neu.trim();
      }
    });
  }
  function createUniversalModule(mod, pos, moduleDirHandle, attachments, modulename) {
    const id = 'mod_' + Math.random().toString(36).slice(2,8);
    const color = mod.color || '#005983';
    const icon = mod.icon ? `<span class="text-2xl mr-2">${mod.icon}</span> ` : '';
    const el = document.createElement('div');
    el.classList.add('grid-stack-item');
    let html = `<div class="grid-stack-item-content rounded-3xl p-6" style="background:${color}">`;
    html += `<div class="text-center font-bold text-xl mb-4">${icon}${mod.name || modulename}</div>`;
    html += `<form id="${id}-form" class="unimod-form grid grid-cols-2 gap-4 mb-2">`;
    (mod.fields || []).forEach(field => {
      const colSpan = field.width === 2 ? 'col-span-2' : 'col-span-1';
      html += `<div class="unimod-field ${colSpan} flex flex-col items-center">`;
      html += `<label class="font-semibold mb-1">${field.label}</label>`;
      if (field.type === 'textarea') {
        html += `<textarea name="${field.key}" class="w-full"></textarea>`;
      } else if (field.type === 'select') {
        html += `<select name="${field.key}" class="w-full">`;
        (field.options||[]).forEach(opt => html += `<option>${opt}</option>`);
        html += `</select>`;
      } else {
        html += `<input type="${field.type}" name="${field.key}" class="w-full" />`;
      }
      html += `</div>`;
    });
    html += `</form>`;
    if (attachments && attachments.length) {
      html += `<div class="text-xs text-blue-200 mb-1">üìé <b>${modulename}:</b> ${attachments.join(', ')}</div>`;
    }
    if (mod.actions && mod.actions.length) {
      html += `<div class="unimod-actions flex gap-2 mb-2">`;
      mod.actions.forEach((act,i) => {
        html += `<button type="button" class="action-btn unimod-btn bg-indigo-500 hover:bg-indigo-600 text-white rounded px-4 py-2" data-script-idx="${i}">${act.label}</button>`;
      });
      html += `</div>`;
    }
    html += `<button class="remove-module bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded mt-2 float-right">üóëÔ∏è Modul entfernen</button>`;
    html += `</div>`;
    el.innerHTML = html;
    grid.addWidget(el, pos || { x:0, y:0, w:8, h:8 });

    const form = el.querySelector('form');
    const fields = {};
    (mod.fields || []).forEach(f => {
      fields[f.key] = form.elements[f.key];
    });

    el.querySelector('.remove-module').onclick = () => grid.removeWidget(el);

    if (mod.actions && mod.actions.length) {
      el.querySelectorAll('.action-btn').forEach(btn => {
        btn.onclick = () => {
          const i = btn.dataset.scriptIdx;
          if (mod.actions[i].script) {
            runUserScript(mod.actions[i].script, fields, { moduleDirHandle, el, modulename });
          }
        };
      });
    }
    if (mod.script) {
      form.addEventListener('input', () => {
        try {
          runUserScript(mod.script, fields, { moduleDirHandle, el, modulename });
        } catch (e) {
          console.error('Script-Fehler:', e);
        }
      });
    }
  }
  function runUserScript(script, fields, context) {
    const helpers = {
      exportAsCSV: (fields) => {
        const row = Object.values(fields).map(f => (f && f.value || '')).join(';');
        const blob = new Blob([row], {type:'text/csv'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = (context.modulename||'modul') + '.csv';
        a.click();
      },
      loadRelatedFile: async (filename) => {
        if (context.moduleDirHandle && filename) {
          try {
            const handle = await context.moduleDirHandle.getFileHandle(filename);
            const file = await handle.getFile();
            if (filename.endsWith('.json')) {
              const data = JSON.parse(await file.text());
              alert('JSON geladen: ' + JSON.stringify(data));
              return data;
            }
            const data = await file.text();
            alert('Text geladen: ' + data);
            return data;
          } catch(e) {
            alert('Datei nicht gefunden: ' + filename);
          }
        }
      }
    };
    const fn = new Function('fields', 'context', ...Object.keys(helpers), script);
    return fn(fields, context, ...Object.values(helpers));
  }

  // --------- Save/Load-Konfig ---------
  function applyConfig(cfg) {
    grid.removeAll();
    cfg.modules.forEach(m => {
      if (m.fields) {
        createUniversalModule(m, { x:m.x, y:m.y, w:m.w, h:m.h }, moduleDirHandle, [], m.name || m.title);
      } else {
        createModule(
          m.title,
          m.submodules.map(s => s.name),
          m.submodules.map(s => s.comment),
          { x:m.x, y:m.y, w:m.w, h:m.h }
        );
      }
    });
    alert('Konfiguration geladen');
  }
  async function saveConfig() {
    const nodes = grid.engine.nodes;
    nodes.sort((a, b) => a.y === b.y ? a.x - b.x : a.y - b.y);
    const modules = nodes.map(node => {
      const c = node.el.querySelector('.grid-stack-item-content');
      const form = c.querySelector('form');
      if (form && form.classList.contains('unimod-form')) {
        const fields = Array.from(form.elements).reduce((obj, el) => {
          if (el.name) obj[el.name] = el.value;
          return obj;
        }, {});
        return {
          name: c.querySelector('.text-xl').innerText,
          fields: Array.from(form.elements).map(el => ({
            key: el.name,
            value: el.value
          })),
          x: node.x, y: node.y, w: node.w, h: node.h
        };
      }
      const title = c.querySelector('.module-title').textContent;
      const submodules = Array.from(c.querySelectorAll('.submodule')).map(s => ({
        name: s.querySelector('.label').textContent,
        comment: s.querySelector('.comments').value || ''
      }));
      return { title, x: node.x, y: node.y, w: node.w, h: node.h, submodules };
    });
    const json = JSON.stringify({ modules }, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'config.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    alert('Download der Konfigurationsdatei gestartet');
  }
  async function loadConfig() {
    if (mainFolderHandle.isFallback) {
      const inp = document.getElementById('config-input');
      inp.onchange = async e => {
        try { applyConfig(JSON.parse(await e.target.files[0].text())); }
        catch { alert('Ung√ºltige Datei'); }
        inp.value = null;
      };
      inp.click();
    } else {
      try {
        const fh = await mainFolderHandle.getFileHandle('config.json');
        const file = await fh.getFile();
        applyConfig(JSON.parse(await file.text()));
      } catch {
        alert('Keine Konfiguration gefunden');
      }
    }
  }
  document.getElementById('set-main-folder').onclick = setMainFolder;
  document.getElementById('save-config').onclick = saveConfig;
  document.getElementById('load-config').onclick = loadConfig;

  // Sidebar Toggle
  const sidebar = document.getElementById('sidebar');
  const toggleSidebarBtn = document.getElementById('toggle-sidebar');
  const sidebarIcon = document.getElementById('sidebar-icon');
  let sidebarVisible = true;
  toggleSidebarBtn.onclick = function() {
    sidebarVisible = !sidebarVisible;
    if (sidebarVisible) {
      sidebar.classList.remove('hidden');
      sidebarIcon.textContent = 'üëÅÔ∏è';
    } else {
      sidebar.classList.add('hidden');
      sidebarIcon.textContent = 'üö´';
    }
  };

  // GridStack init
  document.addEventListener('DOMContentLoaded', () => {
    grid = GridStack.init({
      cellHeight: 100,
      margin: 5,
      handle: '.drag-handle',
      column: 12,
      float: true
    });
    loadConfig();
  });
</script>
</body>
</html>
